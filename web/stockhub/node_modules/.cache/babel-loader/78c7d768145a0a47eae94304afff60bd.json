{"ast":null,"code":"var util = require('util');\n\nvar last = function (str) {\n  str = str.trim();\n  return str[str.length - 1];\n};\n\nvar first = function (str) {\n  return str.trim()[0];\n};\n\nvar notEmpty = function (line) {\n  return line.trim();\n};\n\nvar notEmptyElse = function () {\n  var notNext = false;\n  return function (line, i, lines) {\n    if (notNext) {\n      notNext = false;\n      return '';\n    }\n\n    if (lines[i].trim() === '} else {' && (lines[i + 1] || '').trim() === '}') {\n      notNext = true;\n      return lines[i].replace('} else {', '}');\n    }\n\n    return line;\n  };\n};\n\nmodule.exports = function () {\n  var lines = [];\n  var indent = 0;\n\n  var push = function (str) {\n    var spaces = '';\n\n    while (spaces.length < indent * 2) spaces += '  ';\n\n    lines.push(spaces + str);\n  };\n\n  var line = function (fmt) {\n    if (!fmt) return line;\n\n    if (fmt.trim()[0] === '}' && fmt[fmt.length - 1] === '{') {\n      indent--;\n      push(util.format.apply(util, arguments));\n      indent++;\n      return line;\n    }\n\n    if (fmt[fmt.length - 1] === '{') {\n      push(util.format.apply(util, arguments));\n      indent++;\n      return line;\n    }\n\n    if (fmt.trim()[0] === '}') {\n      indent--;\n      push(util.format.apply(util, arguments));\n      return line;\n    }\n\n    push(util.format.apply(util, arguments));\n    return line;\n  };\n\n  line.trim = function () {\n    lines = lines.filter(notEmpty).map(notEmptyElse()).filter(notEmpty);\n    return line;\n  };\n\n  line.toString = function () {\n    return lines.join('\\n');\n  };\n\n  line.toFunction = function (scope) {\n    var src = 'return (' + line.toString() + ')';\n    var keys = Object.keys(scope || {}).map(function (key) {\n      return key;\n    });\n    var vals = keys.map(function (key) {\n      return scope[key];\n    });\n    return Function.apply(null, keys.concat(src)).apply(null, vals);\n  };\n\n  if (arguments.length) line.apply(null, arguments);\n  return line;\n};","map":null,"metadata":{},"sourceType":"script"}